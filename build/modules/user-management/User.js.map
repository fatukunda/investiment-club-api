{"version":3,"sources":["../../../src/modules/user-management/User.js"],"names":["userSchema","mongoose","Schema","email","type","String","validate","validator","isEmail","message","isAsync","required","unique","trim","username","password","minlength","tokens","token","pre","next","user","isModified","bcrypt","hash","methods","generateAuthToken","jwt","sign","_id","process","env","JWT_KEY","concat","save","statics","findByCredentials","User","findOne","Error","error","compare","isPasswordMatch","model"],"mappings":"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","sourcesContent":["/* eslint-disable func-names */\n/* eslint-disable no-underscore-dangle */\nimport mongoose from 'mongoose';\nimport { isEmail } from 'validator';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\n\nconst userSchema = mongoose.Schema({\n  email: {\n    type: String,\n    validate: {\n      validator: isEmail,\n      message: '{VALUE} is not a valid email.',\n      isAsync: false,\n    },\n    required: [true, 'Email is required.'],\n    unique: true,\n    trim: true,\n  },\n  username: {\n    type: String,\n    required: [true, 'Username is required.'],\n    unique: true,\n    trim: true,\n  },\n  password: {\n    type: String,\n    required: [true, 'Password is required.'],\n    minlength: [6, 'Password should have more than 6 characters.'],\n    trim: true,\n  },\n  tokens: [\n    {\n      token: {\n        type: String,\n        required: true,\n      },\n    },\n  ],\n});\n\nuserSchema.pre('save', async function (next) {\n  // Hash the password before saving the user model\n  const user = this;\n  if (user.isModified('password')) {\n    user.password = await bcrypt.hash(user.password, 8);\n  }\n  next();\n});\n\nuserSchema.methods.generateAuthToken = async function () {\n  // Generate an auth token for the user\n  const user = this;\n  const token = jwt.sign({ _id: user._id }, process.env.JWT_KEY);\n  user.tokens = user.tokens.concat({ token });\n  await user.save();\n  return token;\n};\n\nuserSchema.statics.findByCredentials = async (email, password) => {\n  // Search for a user by email and password.\n  // eslint-disable-next-line no-use-before-define\n  const user = await User.findOne({ email });\n  if (!user) {\n    throw new Error({ error: 'Invalid login credentials' });\n  }\n  const isPasswordMatch = await bcrypt.compare(password, user.password);\n  if (!isPasswordMatch) {\n    throw new Error({ error: 'Invalid login credentials' });\n  }\n  return user;\n};\n\nconst User = mongoose.model('User', userSchema);\n\nexport default User;\n"],"file":"User.js"}